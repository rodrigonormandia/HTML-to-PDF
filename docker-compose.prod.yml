version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      - PORT=8000
    labels:
      - "traefik.enable=true"
      # Rota para API
      - "traefik.http.routers.pdfgravity-api.rule=Host(`htmltopdf.buscarid.com`) && PathPrefix(`/api`)"
      - "traefik.http.routers.pdfgravity-api.entrypoints=websecure"
      - "traefik.http.routers.pdfgravity-api.tls=true"
      - "traefik.http.routers.pdfgravity-api.tls.certresolver=letsencrypt"
      - "traefik.http.services.pdfgravity-api.loadbalancer.server.port=8000"
    networks:
      - traefik_network

  web:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - VITE_API_URL=https://htmltopdf.buscarid.com
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      # Rota principal para frontend
      - "traefik.http.routers.pdfgravity-web.rule=Host(`htmltopdf.buscarid.com`)"
      - "traefik.http.routers.pdfgravity-web.entrypoints=websecure"
      - "traefik.http.routers.pdfgravity-web.tls=true"
      - "traefik.http.routers.pdfgravity-web.tls.certresolver=letsencrypt"
      - "traefik.http.services.pdfgravity-web.loadbalancer.server.port=80"
      # Prioridade menor que a API para que /api seja capturado primeiro
      - "traefik.http.routers.pdfgravity-web.priority=1"
    networks:
      - traefik_network

networks:
  traefik_network:
    external: true
    name: buscarIDnet
